<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Tetris Pro</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-family: system-ui, sans-serif;
  }

  .game {
    display: flex;
    gap: 20px;
  }

  canvas {
    background: #0b0b16;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(108,99,255,.4);
  }

  .panel {
    width: 140px;
  }

  .panel h3 {
    margin: 10px 0 5px;
    font-size: 14px;
    opacity: .8;
  }

  .score {
    font-size: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>

<div class="game">
  <canvas id="game" width="240" height="400"></canvas>

  <div class="panel">
    <h3>Score</h3>
    <div class="score" id="score">0</div>

    <h3>Next</h3>
    <canvas id="next" width="80" height="80"></canvas>

    <h3>Hold (C)</h3>
    <canvas id="hold" width="80" height="80"></canvas>
  </div>
</div>

<script>
const COLS = 10;
const ROWS = 20;
const BLOCK = 20;

const COLORS = {
  I: "#00f0f0",
  O: "#f7d308",
  T: "#b26cff",
  S: "#4cff4c",
  Z: "#ff4c4c",
  J: "#4c6cff",
  L: "#ff9f4c",
  G: "rgba(255,255,255,.2)"
};

const SHAPES = {
  I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],
  O:[[1,1],[1,1]],
  T:[[0,1,0],[1,1,1],[0,0,0]],
  S:[[0,1,1],[1,1,0],[0,0,0]],
  Z:[[1,1,0],[0,1,1],[0,0,0]],
  J:[[1,0,0],[1,1,1],[0,0,0]],
  L:[[0,0,1],[1,1,1],[0,0,0]]
};

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.scale(BLOCK, BLOCK);

const nextCtx = document.getElementById("next").getContext("2d");
nextCtx.scale(20,20);

const holdCtx = document.getElementById("hold").getContext("2d");
holdCtx.scale(20,20);

let board = Array.from({length: ROWS}, () => Array(COLS).fill(0));
let score = 0;

let current = null;
let next = randomPiece();
let hold = null;
let canHold = true;

function randomPiece(){
  const keys = Object.keys(SHAPES);
  const type = keys[Math.floor(Math.random()*keys.length)];
  return {
    type,
    matrix: SHAPES[type].map(r=>r.slice()),
    x: Math.floor(COLS/2)-1,
    y: 0
  };
}

function drawMatrix(m, off, ghost=false){
  m.forEach((r,y)=>r.forEach((v,x)=>{
    if(v){
      ctx.fillStyle = ghost ? COLORS.G : COLORS[current.type];
      ctx.fillRect(x+off.x,y+off.y,1,1);
    }
  }));
}

function collide(p){
  return p.matrix.some((r,y)=>
    r.some((v,x)=>{
      if(!v) return false;
      let nx=p.x+x, ny=p.y+y;
      return nx<0||nx>=COLS||ny>=ROWS||board[ny]?.[nx];
    })
  );
}

function merge(){
  current.matrix.forEach((r,y)=>r.forEach((v,x)=>{
    if(v) board[current.y+y][current.x+x]=current.type;
  }));
}

function clearLines(){
  for(let y=ROWS-1;y>=0;y--){
    if(board[y].every(v=>v)){
      board.splice(y,1);
      board.unshift(Array(COLS).fill(0));
      score+=100;
    }
  }
}

function rotate(){
  const m=current.matrix;
  for(let y=0;y<m.length;y++)
    for(let x=0;x<y;x++)
      [m[x][y],m[y][x]]=[m[y][x],m[x][y]];
  m.forEach(r=>r.reverse());
  if(collide(current)) rotate(); // undo
}

function hardDrop(){
  while(!collide(current)) current.y++;
  current.y--;
  lock();
}

function lock(){
  merge();
  clearLines();
  current = next;
  next = randomPiece();
  canHold = true;
}

function holdPiece(){
  if(!canHold) return;
  if(!hold){
    hold=current;
    current=next;
    next=randomPiece();
  }else{
    [current,hold]=[hold,current];
  }
  current.x=Math.floor(COLS/2)-1;
  current.y=0;
  canHold=false;
}

function ghostY(){
  let y=current.y;
  while(!collide({...current,y:y+1})) y++;
  return y;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  board.forEach((r,y)=>r.forEach((v,x)=>{
    if(v){
      ctx.fillStyle=COLORS[v];
      ctx.fillRect(x,y,1,1);
    }
  }));

  drawMatrix(current.matrix,{x:current.x,y:ghostY()},true);
  drawMatrix(current.matrix,{x:current.x,y:current.y});

  document.getElementById("score").textContent=score;
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft"){current.x--; if(collide(current))current.x++;}
  if(e.key==="ArrowRight"){current.x++; if(collide(current))current.x--;}
  if(e.key==="ArrowDown"){current.y++; if(collide(current)){current.y--; lock();}}
  if(e.key==="ArrowUp") rotate();
  if(e.code==="Space") hardDrop();
  if(e.key==="c"||e.key==="C") holdPiece();
});

let drop=0;
function loop(t=0){
  if(t-drop>700){
    current.y++;
    if(collide(current)){current.y--; lock();}
    drop=t;
  }
  draw();
  requestAnimationFrame(loop);
}

current=randomPiece();
loop();
</script>
</body>
</html>
